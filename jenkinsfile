def TEST = 'failure'
try {

node {
stage ("clone") {
   sh 'env'
        def scmVars = checkout([
        $class: 'GitSCM',
          branches: [[name: '${GIT_BRANCH}']],
          userRemoteConfigs: [[credentialsId: '', url: 'https://github.com/rameshthoomu/jenkins_commits']]])
                  // Display the variable using scmVars
      echo "scmVars.GIT_COMMIT"
      echo "${scmVars.GIT_COMMIT}"

      // Displaying the variables saving it as environment variable
      env.GIT_COMMIT = scmVars.GIT_COMMIT
      echo "env.GIT_COMMIT"
      env.GIT_PREVIOUS_SUCCESSFUL_COMMIT = scmVars.GIT_PREVIOUS_SUCCESSFUL_COMMIT
      echo "${env.GIT_COMMIT}"
      echo "${scmVars.GIT_PREVIOUS_SUCCESSFUL_COMMIT}"
         sh 'env'
   }
   stage("next stage") {
   dir('ui') {
    echo "${GIT_COMMIT}"
    echo "${GIT_PREVIOUS_SUCCESSFUL_COMMIT}"
    CHANGED = sh(returnStdout: true, script: 'git diff --name-only ${GIT_PREVIOUS_SUCCESSFUL_COMMIT} ${GIT_COMMIT} $WORKSPACE/ui')
   }
   echo "====> ${CHANGED}"
   if ("${CHANGED}".isEmpty()) {
     echo "no changed"
   }
   else {
    echo "Changed"
   }
   } //stage
}
} finally { 
if("${TEST}" == 'success') {
  echo "Success"
                      emailext subject: '$DEFAULT_SUBJECT',
                        body: '$DEFAULT_CONTENT',
                        recipientProviders: [
                            [$class: 'CulpritsRecipientProvider'],
                            [$class: 'DevelopersRecipientProvider'],
                            [$class: 'RequesterRecipientProvider']
                        ], 
                        replyTo: '$DEFAULT_REPLYTO',
                        to: '$DEFAULT_RECIPIENTS'
  } 
  else {
  echo "failure"
                      emailext subject: '$DEFAULT_SUBJECT',
                        body: '$DEFAULT_CONTENT',
                        recipientProviders: [
                            [$class: 'CulpritsRecipientProvider'],
                            [$class: 'DevelopersRecipientProvider'],
                            [$class: 'RequesterRecipientProvider']
                        ], 
                        replyTo: '$DEFAULT_REPLYTO',
                        to: '$DEFAULT_RECIPIENTS'
  }
  }

